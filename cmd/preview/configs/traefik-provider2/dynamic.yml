http:
  routers:
    provider2-dashboard:
      rule: "Host(`provider2.example.com`)"
      service: "provider2-service"
      middlewares:
        - "provider2-cors"
      entryPoints:
        - "web"
    
    provider2-api:
      rule: "Host(`provider2.example.com`) && PathPrefix(`/api`)"
      service: "provider2-api-service"
      middlewares:
        - "provider2-rate-limit"
        - "provider2-retry"
      entryPoints:
        - "web"
    
    provider2-secure:
      rule: "Host(`secure.provider2.example.com`)"
      service: "provider2-secure-service"
      middlewares:
        - "provider2-auth"
      entryPoints:
        - "websecure"
      tls: {}
    
    provider2-metrics:
      rule: "Host(`metrics.provider2.example.com`) && PathPrefix(`/metrics`)"
      service: "provider2-metrics-service"
      entryPoints:
        - "web"

  services:
    provider2-service:
      loadBalancer:
        servers:
          - url: "http://nginx:80"
        healthCheck:
          path: "/health"
          interval: "10s"
    
    provider2-api-service:
      loadBalancer:
        servers:
          - url: "http://whoami:80"
          - url: "http://nginx:80"
        sticky:
          cookie:
            name: "provider2-api-session"
            secure: true
    
    provider2-secure-service:
      loadBalancer:
        servers:
          - url: "http://redis:6379"
    
    provider2-metrics-service:
      loadBalancer:
        servers:
          - url: "http://whoami:80"

  middlewares:
    provider2-cors:
      headers:
        accessControlAllowMethods:
          - "GET"
          - "POST"
          - "PUT"
          - "DELETE"
        accessControlAllowOriginList:
          - "https://provider2.example.com"
        accessControlAllowHeaders:
          - "Content-Type"
          - "Authorization"
    
    provider2-rate-limit:
      rateLimit:
        burst: 50
        average: 25
    
    provider2-retry:
      retry:
        attempts: 3
    
    provider2-auth:
      basicAuth:
        users:
          - "provider2:$2y$10$..."
    
    provider2-strip-prefix:
      stripPrefix:
        prefixes:
          - "/api/v1"

  serversTransports:
    provider2-transport:
      serverName: "provider2.internal"
      insecureSkipVerify: true
      rootCAs:
        - "/etc/ssl/certs/provider2-ca.crt"

tcp:
  routers:
    provider2-database:
      rule: "HostSNI(`db-provider2.example.com`)"
      service: "provider2-db-service"
      entryPoints:
        - "tcp-ep"
      middlewares:
        - "provider2-tcp-limit"
    
    provider2-ssh:
      rule: "HostSNI(`ssh-provider2.example.com`)"
      service: "provider2-ssh-service"
      entryPoints:
        - "tcp-ep"

  services:
    provider2-db-service:
      loadBalancer:
        servers:
          - address: "redis:6379"
    
    provider2-ssh-service:
      loadBalancer:
        servers:
          - address: "tcp-echo:8080"

  middlewares:
    provider2-tcp-limit:
      inFlightConn:
        amount: 5

udp:
  routers:
    provider2-logs:
      service: "provider2-log-service"
      entryPoints:
        - "udp-ep"
    
    provider2-syslog:
      service: "provider2-syslog-service"
      entryPoints:
        - "udp-ep"

  services:
    provider2-log-service:
      loadBalancer:
        servers:
          - address: "udp-echo:8080"
    
    provider2-syslog-service:
      loadBalancer:
        servers:
          - address: "udp-echo:8080"

tls:
  certificates:
    - certFile: "/etc/ssl/certs/provider2.crt"
      keyFile: "/etc/ssl/private/provider2.key"
      stores:
        - "provider2"
  
  options:
    provider2-tls:
      minVersion: "VersionTLS13"
      cipherSuites:
        - "TLS_AES_256_GCM_SHA384"
        - "TLS_CHACHA20_POLY1305_SHA256"
  
  stores:
    provider2:
      defaultCertificate:
        certFile: "/etc/ssl/certs/provider2-default.crt"
        keyFile: "/etc/ssl/private/provider2-default.key"
